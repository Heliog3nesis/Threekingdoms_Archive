<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>公卿表</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="../style.css">
  <style>
  h1{
    font-size:20px;
    margin-top:3rem;
    margin-left: 2rem;
  }
  h2 {
    margin-top: 2rem;
    margin-left: 2rem;
    font-size: 16px;
  }
  .custom-sheet, .sheet-selector {
    margin-left: 2rem;
    font-size: 14px;
  }
  select {
    padding: 0.5rem;
    background: #222;
    color: white;
    border: 1px solid #555;
    margin-bottom: 1rem;
    font-size: 14px;
  }

  /* scroll container */
  .table-wrapper{
    width: 90%;
    margin: 0 auto 2rem auto;
  }

  table {
    border-collapse: collapse;
    width: 100%;              
    background: #222;
    font-size: 14px;
    table-layout: auto;
  }

  th, td {
    border: 1px solid #555;
    padding: 6px 10px;
    color: white;
    min-width: 10ch;
  }

  /* sticky first row */
  .table-wrapper table tr:first-child > td{
    position: sticky;
    top: 45px;
    z-index: 5;
    color: #FFFF00 !important;
    background: #111;
    opacity: 1;
    line-height: 1.25;
    font-size: 1.15em;  
    box-shadow:
    inset 0 -2px 0 black,  
    inset 0 2px 0 black, 
    inset -2px 0 0 black, 
    inset 2px 0 0 black,  
    0 2px 6px rgba(0,0,0,0.55); 
    }
  

  /* Column tint backgrounds */
  .col-wei { background: rgba(0, 204, 153, 0.14); }
  .col-shu { background: rgba(181, 126, 255, 0.14); }
  .col-wu  { background: rgba(255, 140, 64, 0.14); }

  /* Box borders (left/right edges of each state block) */
  .col-wei.start { border-left: 2px solid rgba(0, 204, 153, 0.55); }
  .col-wei.end   { border-right: 2px solid rgba(0, 204, 153, 0.55); }

  .col-shu.start { border-left: 2px solid rgba(181, 126, 255, 0.55); }
  .col-shu.end   { border-right: 2px solid rgba(181, 126, 255, 0.55); }

  .col-wu.start  { border-left: 2px solid rgba(255, 140, 64, 0.55); }
  .col-wu.end    { border-right: 2px solid rgba(255, 140, 64, 0.55); }

  /* Sticky row + tint compatibility */
  .table-wrapper table tr:first-child > td.col-wei { background-color: #0b3b33 }
  .table-wrapper table tr:first-child > td.col-shu { background-color: #2d2440 }
  .table-wrapper table tr:first-child > td.col-wu  { background-color: #3b2a1b }
</style>
</head>
<body>
<div id="navbar"></div>
  <h1>公卿表</h1>
<button 
  onclick="location.href='officials_table_index_zh.html';" 
  style="margin-left: 1rem; padding: 0.5rem 1rem; font-size: 14px; background: transparent; color: white; border: 1px solid white; border-radius: 4px; cursor: pointer;">
  ← 返回
</button>
  <h2>類別</h2>
  <div class="sheet-selector">
  <label for="sheet-select">請選擇:</label>
  <select id="sheet-select"></select>
  </div>
  <!-- per-sheet note  -->
  <div id="sheet-notes" style="margin: 0 auto 2rem auto; width: 90%; font-size: 0.8rem;"></div>

  <div id="table-container"></div>

  <script>
    let sheetData = {};

    // whitespace-tolerant match 
    const norm = (s) => String(s).replace(/\u00A0/g, " ").replace(/\s+/g, " ").trim();

    const SHEET_NOTE_GROUPS = [
    {
      sheets: ["上公 Superior Excellency"],
      note: "上公，指在三公之上。漢代多以此銜授予元老或重臣，其中以太傅最為常見。然上公實為榮銜，其政治影響多源於任者資歷、聲望及其所兼職。自武帝后，丞相多不設，至漢末魏晉動蕩之際，丞相方復起，軍事要職亦躋身上公之列。"
    },
    {
      sheets: ["三公 Three Excellencies"],
      note: "西漢初設三公以分丞相之權。及至東漢，三公雖爵高祿厚，名義上分統九卿，然其議政之權已漸移尚書台，形成「雖置三公，而事歸臺閣」之局。故此際三公，頗類榮銜，其實權與影響力因人因時而異。魏晉時，尚書台多總攬機要，凡政策執行、官吏選任、文書上奏亦可越過三公，徑行處理。"
    },
    {
      sheets: ["九卿(一) Nine Ministers I", "九卿(二) Nine Ministers II","九卿(三) Nine Ministers III","其他 Others"],
      note: "漢初雖有「九卿」之名，並無確切九官。直至東漢，方確立太常九職為「九卿」。吳韋昭又以此九卿為正卿，執金吾、將作大匠、大長秋為外卿。執金吾、將作大匠見「其他 Others」；大長秋事后宮，分錄于后宮東宮之「皇后 Empress」。 "
    }
  ];

    const DEFAULT_SHEET_NOTE = ""; // fallback if a sheet has no note

    let SHEET_NOTE_LOOKUP = {};

    function buildSheetNoteLookup() {
      const lookup = {};
      for (const group of SHEET_NOTE_GROUPS) {
        const names = Array.isArray(group.sheets) ? group.sheets : [group.sheets];
        for (const name of names) {
          lookup[norm(name)] = group.note;
        }
      }
      SHEET_NOTE_LOOKUP = lookup;
    }

    function updateSheetNotes(sheetName) {
      const el = document.getElementById("sheet-notes");
      if (!el) return;

      const note = SHEET_NOTE_LOOKUP[norm(sheetName)];
      el.innerHTML = note ?? DEFAULT_SHEET_NOTE;
    }

    fetch("../translations/excellencies_ministers_webdisplay.json")
      .then(res => res.json())
      .then(data => {
        const sheetNames = Object.keys(data);
        sheetData = data;
        buildSheetNoteLookup();

        const selector = document.getElementById("sheet-select");
        sheetNames.forEach(sheet => {
          const opt = document.createElement("option");
          opt.value = sheet;
          opt.textContent = sheet;
          selector.appendChild(opt);
        });

        selector.addEventListener("change", () => renderSheet(selector.value));

        // read sheet from URL and select it if possible
        const params = new URLSearchParams(window.location.search);
        const sheetFromUrlRaw = params.get("sheet") || "";
        const wanted = norm(sheetFromUrlRaw);

        let initialSheet = sheetNames[0];
        if (wanted) {
          const match = sheetNames.find(name => norm(name) === wanted);
          if (match) initialSheet = match;
        }

        selector.value = initialSheet;
        renderSheet(initialSheet);
      });

    function renderSheet(sheetName) {
      // Update note whenever a sheet is rendered
      updateSheetNotes(sheetName);

      const rows = sheetData[sheetName];
      const container = document.getElementById("table-container");

      let html = `<div class="table-wrapper"><table>`;

      for (let i = 0; i < rows.length; i++) {
        html += "<tr>";

        for (let j = 0; j < rows[i].length; j++) {
          const cell = rows[i][j];
          if (!cell) continue;

          const value = cell.text || "";
          const color = cell.color ? `color:#${cell.color};` : "";
          const rowspan = cell.rowspan ? `rowspan="${cell.rowspan}"` : "";
          const colspanNum = cell.colspan ? Number(cell.colspan) : 1;   
          const colspanAttr = cell.colspan ? `colspan="${cell.colspan}"` : "";

          const classes = [];

          // Only tint cells that do NOT span across columns
          if (colspanNum === 1) {
            if (j === 0 || j === 1) classes.push("col-wei");
            if (j === 2 || j === 3) classes.push("col-shu");
            if (j === 4 || j === 5) classes.push("col-wu");

            if (j === 0 || j === 2 || j === 4) classes.push("start");
            if (j === 1 || j === 3 || j === 5) classes.push("end");
          }

          html += `<td class="${classes.join(" ")}" style="${color}" ${rowspan} ${colspanAttr}>${value}</td>`;
        }

        html += "</tr>";
      }

      html += "</table></div>";
      container.innerHTML = html;
    }

  </script>
  <div id="footer"></div>

  <script>
  async function includeHTML(id, file, callback) {
    const res = await fetch(file);
    const html = await res.text();
    document.getElementById(id).innerHTML = html;

    if (callback) callback();
  }

  
  includeHTML("navbar", "nav_zh.html", () => {

    const script = document.createElement("script");
    script.src = "scripts/navbar_zh.js"; 
    script.defer = true;


    script.onload = () => {
      const isGithub = location.hostname.includes("github.io");
      const pathParts = window.location.pathname.split("/");
      const repoName = pathParts[1] || "";
      const basePath = isGithub ? `/${repoName}/` : "/";

      if (typeof setNavLinks === "function") {
        setNavLinks(basePath);
      } else {
        console.warn("Navbar logic (setNavLinks) did not load");
      }
    };

    document.head.appendChild(script);
  });

 
  includeHTML("footer", "../footer.html");
</script>

</body>
</html>

