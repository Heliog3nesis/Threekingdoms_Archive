<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Table of Military Officials</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="../style.css">
<style>
  h1{
    font-size:20px;
    margin-top:3rem;
    margin-left: 2rem;
  }
  h2 {
    margin-top: 2rem;
    margin-left: 2rem;
    font-size: 16px;
  }
  .custom-sheet, .sheet-selector {
    margin-left: 2rem;
    font-size: 14px;
  }
  select {
    padding: 0.5rem;
    background: #222;
    color: white;
    border: 1px solid #555;
    margin-bottom: 1rem;
    font-size: 14px;
  }

  /* scroll container */
  .table-wrapper{
    width: 90%;
    margin: 0 auto 2rem auto;
  }

  table {
    border-collapse: collapse;
    width: 100%;              
    background: #222;
    font-size: 14px;
    table-layout: auto;
  }

  th, td {
    border: 1px solid #555;
    padding: 6px 10px;
    color: white;
    min-width: 10ch;
  }

  /* sticky first row */
  .table-wrapper table tr:first-child > td{
    position: sticky;
    top: 45px;
    z-index: 5;
    color: #FFFF00 !important;
    background: #111;
    opacity: 1;
    line-height: 1.25;
    font-size: 1.15em;  
    box-shadow:
    inset 0 -2px 0 black,  
    inset 0 2px 0 black, 
    inset -2px 0 0 black, 
    inset 2px 0 0 black,  
    0 2px 6px rgba(0,0,0,0.55); 
    }
  

  /* Column tint backgrounds */
  .col-wei { background: rgba(0, 204, 153, 0.14); }
  .col-shu { background: rgba(181, 126, 255, 0.14); }
  .col-wu  { background: rgba(255, 140, 64, 0.14); }

  /* Box borders (left/right edges of each state block) */
  .col-wei.start { border-left: 2px solid rgba(0, 204, 153, 0.55); }
  .col-wei.end   { border-right: 2px solid rgba(0, 204, 153, 0.55); }

  .col-shu.start { border-left: 2px solid rgba(181, 126, 255, 0.55); }
  .col-shu.end   { border-right: 2px solid rgba(181, 126, 255, 0.55); }

  .col-wu.start  { border-left: 2px solid rgba(255, 140, 64, 0.55); }
  .col-wu.end    { border-right: 2px solid rgba(255, 140, 64, 0.55); }

  /* Sticky row + tint compatibility */
  .table-wrapper table tr:first-child > td.col-wei { background-color: #0b3b33 }
  .table-wrapper table tr:first-child > td.col-shu { background-color: #2d2440 }
  .table-wrapper table tr:first-child > td.col-wu  { background-color: #3b2a1b }
</style>

</head>
<body>
<div id="navbar"></div>
  <h1>Table of Military Officials</h1>
<button 
  onclick="location.href='officials_table_index.html';" 
  style="margin-left: 1rem; padding: 0.5rem 1rem; font-size: 14px; background: transparent; color: white; border: 1px solid white; border-radius: 4px; cursor: pointer;">
  ← Return
    </button>



  <h2>Categories</h2>
  <div class="sheet-selector">
  <label for="sheet-select">Select Sheet:</label>
  <select id="sheet-select"></select>
  </div>
  <!-- per-sheet note  -->
  <div id="sheet-notes" style="margin: 0 auto 2rem auto; width: 90%; font-size: 0.8rem;"></div>

  <div id="table-container"></div>

  <script>
    let sheetData = {};

    // whitespace-tolerant match 
    const norm = (s) => String(s).replace(/\u00A0/g, " ").replace(/\s+/g, " ").trim();

    const SHEET_NOTE_GROUPS = [
    {
      sheets: ["中軍 Central Army", "城門 Capital Gates"],
      note: "Under the Han system, eunuchs were responsible for guarding within the inner quarters of the palace; the Minister of the Household commanded units such as the Feathered Forest to guard the palace halls and gates; the Commandant of the Guards patrolled the palace interior and its gates; and the Bearer of the Golden Mace oversaw security outside the palace. In addition, Colonels of the City Gates were responsible for the city gates, while the Five Colonels and the Northern and Southern Armies were stationed outside the capital. From the Eastern (Later) Han onward, however, the Bearer of the Golden Mace gradually became ceremonial; by the Wei–Jin period, the Commandant of the Guards and Minister of the Household likewise became relatively unimportant, and their guard responsibilities correspondingly declined.<br> <br> Amid the frequent warfare of the Three Kingdoms period, the various regimes expanded their capital guards, organizing large “Central Armies” stationed near the capital for deployment; when dispatched to support local troops in the commanderies and provinces, these forces were referred to as “Outer Armies.” Wei established new units such as the Martial Guards and Mobile Forces camps as the core of its Central Army, with the Martial Guards responsible for guarding the palace. Shu also had similar units such as the Feathered Forest and Tiger Strides camps. In Wei and Shu, though the Five Colonels were established, they were largely ceremonial, and in some cases had many officers but few troops. In Wu, palace guard forces were largely drawn from units such as the Martial Guards and the Feathered Forest. These were often commanded by members of the Sun clan, and the Five Colonels there retained something closer to the functional role once fulfilled by the Han Five Colonels."
    },
    {
      sheets: ["四征四鎮 Conquering & Garrisoning","四安四平 Pacifying & Subduing", "四方及雜號 Four Direction & Misc"],
      note: "All three states of Wei, Shu, and Wu established “Comparable to Excellencies” generals such as the Grand General and General of Agile Cavalry. Beneath them came various titled Grand Generals (e.g., Grand General Who Guards the Army), followed by the high-ranking titled generals, and finally the miscellaneous generals. <br> <br> Among the high-ranking titled generals, Wei ranked the Four Conquering Generals highest, followed by the Four Garrisoning, then the Four Pacifying and Four Subduing, with the Four Direction Generals occupying a comparatively lower rank. Shu instead accorded the highest status to specially designated titles such as General Who Pacifies the Han and Strategist General, followed by the Four Direction Generals, then those bearing Garrisoning, Pacifying, and Subduing titles, while Conquering Generals ranked lowest. Wu likewise regularly appointed Conquering, Garrisoning, Pacifying, Subduing and Direction Generals, among whom the Four Directions titles held relatively high status, resembling Shu systems. The Bulwark General of Wu ranked just below the Three Excellencies, while the relative ordering of other titles is unclear. "
    },
    {
      sheets:["諸大將軍 Various Grand Generals"],
      note: ["All three states of Wei, Shu, and Wu established “Comparable to Excellencies” generals such as the Grand General and General of Agile Cavalry. Beneath them came various titled Grand Generals (e.g., Grand General Who Guards the Army), followed by the high-ranking titled generals, and finally the miscellaneous generals."],
    }
  ];

    const DEFAULT_SHEET_NOTE = ""; // fallback if a sheet has no note

    let SHEET_NOTE_LOOKUP = {};

    function buildSheetNoteLookup() {
      const lookup = {};
      for (const group of SHEET_NOTE_GROUPS) {
        const names = Array.isArray(group.sheets) ? group.sheets : [group.sheets];
        for (const name of names) {
          lookup[norm(name)] = group.note;
        }
      }
      SHEET_NOTE_LOOKUP = lookup;
    }

    function updateSheetNotes(sheetName) {
      const el = document.getElementById("sheet-notes");
      if (!el) return;

      const note = SHEET_NOTE_LOOKUP[norm(sheetName)];
      el.innerHTML = note ?? DEFAULT_SHEET_NOTE;
    }

    fetch("military_officials_webdisplay.json")
      .then(res => res.json())
          .then(data => {
        const sheetNames = Object.keys(data);   
        sheetData = data;
        buildSheetNoteLookup();

        const selector = document.getElementById("sheet-select");
        sheetNames.forEach(sheet => {           
        const opt = document.createElement("option");
        opt.value = sheet;
        opt.textContent = sheet;
        selector.appendChild(opt);
        });

        selector.addEventListener("change", () => renderSheet(selector.value));
                // read sheet from URL and select it if possible
        const params = new URLSearchParams(window.location.search);
        const sheetFromUrlRaw = params.get("sheet") || "";

        // whitespace-tolerant match (handles double spaces / trailing spaces)
        const norm = (s) => String(s).replace(/\u00A0/g, " ").replace(/\s+/g, " ").trim();
        const wanted = norm(sheetFromUrlRaw);

        let initialSheet = sheetNames[0];
        if (wanted) {
          const match = sheetNames.find(name => norm(name) === wanted);
          if (match) initialSheet = match;
        }

        selector.value = initialSheet;
        renderSheet(initialSheet);              
    });

    function renderSheet(sheetName) {
      // Update note whenever a sheet is rendered
      updateSheetNotes(sheetName);
      const rows = sheetData[sheetName];
      const container = document.getElementById("table-container");

      let html = `<div class="table-wrapper"><table>`;

      for (let i = 0; i < rows.length; i++) {
        html += "<tr>";

        for (let j = 0; j < rows[i].length; j++) {
          const cell = rows[i][j];
          if (!cell) continue;

          const value = cell.text || "";
          const color = cell.color ? `color:#${cell.color};` : "";
          const rowspan = cell.rowspan ? `rowspan="${cell.rowspan}"` : "";
          const colspanNum = cell.colspan ? Number(cell.colspan) : 1;   
          const colspanAttr = cell.colspan ? `colspan="${cell.colspan}"` : "";

          const classes = [];

          // Only tint cells that do NOT span across columns
          if (colspanNum === 1) {
            if (j === 0 || j === 1) classes.push("col-wei");
            if (j === 2 || j === 3) classes.push("col-shu");
            if (j === 4 || j === 5) classes.push("col-wu");

            if (j === 0 || j === 2 || j === 4) classes.push("start");
            if (j === 1 || j === 3 || j === 5) classes.push("end");
          }

          html += `<td class="${classes.join(" ")}" style="${color}" ${rowspan} ${colspanAttr}>${value}</td>`;
        }

        html += "</tr>";
      }

      html += "</table></div>";
      container.innerHTML = html;
    }

  </script>
  <div id="footer"></div>

<script>
  async function includeHTML(id, file, callback) {
    const res = await fetch(file);
    const html = await res.text();
    document.getElementById(id).innerHTML = html;

    if (callback) callback();
  }

  
  includeHTML("navbar", "../nav.html", () => {

    const script = document.createElement("script");
    script.src = "../scripts/navbar.js"; 
    script.defer = true;


    script.onload = () => {
      const isGithub = location.hostname.includes("github.io");
      const pathParts = window.location.pathname.split("/");
      const repoName = pathParts[1] || "";
      const basePath = isGithub ? `/${repoName}/` : "/";

      if (typeof setNavLinks === "function") {
        setNavLinks(basePath);
      } else {
        console.warn("Navbar logic (setNavLinks) did not load");
      }
    };

    document.head.appendChild(script);
  });

 
  includeHTML("footer", "../footer.html");
</script>
</body>
</html>