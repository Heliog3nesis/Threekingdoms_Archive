<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Table of Privy Court and Departmental Officials</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="../style.css">
<style>
  h1{
    font-size:20px;
    margin-top:3rem;
    margin-left: 2rem;
  }
  h2 {
    margin-top: 2rem;
    margin-left: 2rem;
    font-size: 16px;
  }
  .custom-sheet, .sheet-selector {
    margin-left: 2rem;
    font-size: 14px;
  }
  select {
    padding: 0.5rem;
    background: #222;
    color: white;
    border: 1px solid #555;
    margin-bottom: 1rem;
    font-size: 14px;
  }

  /* scroll container */
  .table-wrapper{
    width: 90%;
    margin: 0 auto 2rem auto;
  }

  table {
    border-collapse: collapse;
    width: 100%;              
    background: #222;
    font-size: 14px;
    table-layout: auto;
  }

  th, td {
    border: 1px solid #555;
    padding: 6px 10px;
    color: white;
    min-width: 10ch;
  }

  /* sticky first row */
  .table-wrapper table tr:first-child > td{
    position: sticky;
    top: 45px;
    z-index: 5;
    color: #FFFF00 !important;
    background: #111;
    opacity: 1;
    line-height: 1.25;
    font-size: 1.15em;  
    box-shadow:
    inset 0 -2px 0 black,  
    inset 0 2px 0 black, 
    inset -2px 0 0 black, 
    inset 2px 0 0 black,  
    0 2px 6px rgba(0,0,0,0.55); 
    }
  

  /* Column tint backgrounds */
  .col-wei { background: rgba(0, 204, 153, 0.14); }
  .col-shu { background: rgba(181, 126, 255, 0.14); }
  .col-wu  { background: rgba(255, 140, 64, 0.14); }

  /* Box borders (left/right edges of each state block) */
  .col-wei.start { border-left: 2px solid rgba(0, 204, 153, 0.55); }
  .col-wei.end   { border-right: 2px solid rgba(0, 204, 153, 0.55); }

  .col-shu.start { border-left: 2px solid rgba(181, 126, 255, 0.55); }
  .col-shu.end   { border-right: 2px solid rgba(181, 126, 255, 0.55); }

  .col-wu.start  { border-left: 2px solid rgba(255, 140, 64, 0.55); }
  .col-wu.end    { border-right: 2px solid rgba(255, 140, 64, 0.55); }

  /* Sticky row + tint compatibility */
  .table-wrapper table tr:first-child > td.col-wei { background-color: #0b3b33 }
  .table-wrapper table tr:first-child > td.col-shu { background-color: #2d2440 }
  .table-wrapper table tr:first-child > td.col-wu  { background-color: #3b2a1b }
</style>

</head>
<body>
<div id="navbar"></div>
  <h1>Table of Privy Court and Departmental Officials</h1>
<button 
  onclick="location.href='officials_table_index.html';" 
  style="margin-left: 1rem; padding: 0.5rem 1rem; font-size: 14px; background: transparent; color: white; border: 1px solid white; border-radius: 4px; cursor: pointer;">
  ← Return
    </button>



  <h2>Categories</h2>
  <div class="sheet-selector">
  <label for="sheet-select">Select Sheet:</label>
  <select id="sheet-select"></select>
  </div>
<!-- per-sheet note  -->
  <div id="sheet-notes" style="margin: 0 auto 2rem auto; width: 90%; font-size: 0.8rem;"></div>

  <div id="table-container"></div>

  <script>
    let sheetData = {};

    // whitespace-tolerant match 
    const norm = (s) => String(s).replace(/\u00A0/g, " ").replace(/\s+/g, " ").trim();

    const SHEET_NOTE_GROUPS = [
    {
      sheets: ["門下 Chancellery"],
      note: "During the Han, 門下 menxia (“At/Within the Gates”) was originally a broad, generic term, applied to officials responsible for any court duties within the palace. By the Wei–Jin period, however, its meaning had narrowed, referring specifically to close attendants serving in the inner halls of the imperial palace.<br> <br> From the mid–Eastern (Later) Han onward, the authority of the Three Excellencies gradually waned, while that of the Imperial Secretariats steadily increased. Since the Imperial Secretariats shifted from private attendants of the emperor to officials who managed the core affairs of government and participated in outside court politics, they were no longer involved in internal palace duties. To counterbalance this shift of power and to retain direct control over critical decisions, the emperor selected close palace attendants to review memorials submitted by the Imperial Secretariats and to assist in drafting and issuing responses, an arrangement that later evolved into the Chancellery Department. In some cases, separate confidential offices were also established to take over certain key duties from the Imperial Secretariats, laying the foundations for what would later be known as the Palace Secretariat Department."
    },
    {
      sheets: ["中書 Palace Secretariat","尚書 State Affairs"],
      note: "From the mid–Eastern (Later) Han onward, the authority of the Three Excellencies gradually waned, while that of the Imperial Secretariats steadily increased. Since the Imperial Secretariats shifted from private attendants of the emperor to officials who managed the core affairs of government and participated in outside court politics, they were no longer involved in internal palace duties. To counterbalance this shift of power and to retain direct control over critical decisions, the emperor selected close palace attendants to review memorials submitted by the Imperial Secretariats and to assist in drafting and issuing responses, an arrangement that later evolved into the Chancellery Department. In some cases, separate confidential offices were also established to take over certain key duties from the Imperial Secretariats, laying the foundations for what would later be known as the Palace Secretariat Department."
    },
    {
      sheets: ["御史臺 Censorate"],
      note: "In the pre-Qin period, the Censor was originally a court historian responsible for records and archives. From the Qin and Han onward, this office was maintained and further entrusted with the supervision of officials. During the Western (Former) Han, the Imperial Censor ranked just below the Chancellor and functioned as both his collaborator and institutional counterweight. By the Eastern (Later) Han, however, the Imperial Censor title was changed to Excellency of Works among the Three Excellencies, its authority gradually hollowed out, and effective control of the Censorate passed instead to the Deputy Imperial Censor. "
    },
  ];

    const DEFAULT_SHEET_NOTE = ""; // fallback if a sheet has no note

    let SHEET_NOTE_LOOKUP = {};

    function buildSheetNoteLookup() {
      const lookup = {};
      for (const group of SHEET_NOTE_GROUPS) {
        const names = Array.isArray(group.sheets) ? group.sheets : [group.sheets];
        for (const name of names) {
          lookup[norm(name)] = group.note;
        }
      }
      SHEET_NOTE_LOOKUP = lookup;
    }

    function updateSheetNotes(sheetName) {
      const el = document.getElementById("sheet-notes");
      if (!el) return;

      const note = SHEET_NOTE_LOOKUP[norm(sheetName)];
      el.innerHTML = note ?? DEFAULT_SHEET_NOTE;
    }

    fetch("./central_court_webdisplay.json")
      .then(res => res.json())
      .then(data => {
        const sheetNames = Object.keys(data);
        sheetData = data;
        buildSheetNoteLookup();

        const selector = document.getElementById("sheet-select");
        sheetNames.forEach(sheet => {
          const opt = document.createElement("option");
          opt.value = sheet;
          opt.textContent = sheet;
          selector.appendChild(opt);
        });

        selector.addEventListener("change", () => renderSheet(selector.value));

        // read sheet from URL and select it if possible
        const params = new URLSearchParams(window.location.search);
        const sheetFromUrlRaw = params.get("sheet") || "";
        const wanted = norm(sheetFromUrlRaw);

        let initialSheet = sheetNames[0];
        if (wanted) {
          const match = sheetNames.find(name => norm(name) === wanted);
          if (match) initialSheet = match;
        }

        selector.value = initialSheet;
        renderSheet(initialSheet);
      });

    function renderSheet(sheetName) {
      // Update note whenever a sheet is rendered
      updateSheetNotes(sheetName);
      const rows = sheetData[sheetName];
      const container = document.getElementById("table-container");

      let html = `<div class="table-wrapper"><table>`;

      for (let i = 0; i < rows.length; i++) {
        html += "<tr>";

        for (let j = 0; j < rows[i].length; j++) {
          const cell = rows[i][j];
          if (!cell) continue;

          const value = cell.text || "";
          const color = cell.color ? `color:#${cell.color};` : "";
          const rowspan = cell.rowspan ? `rowspan="${cell.rowspan}"` : "";
          const colspanNum = cell.colspan ? Number(cell.colspan) : 1;   
          const colspanAttr = cell.colspan ? `colspan="${cell.colspan}"` : "";

          const classes = [];

          // Only tint cells that do NOT span across columns
          if (colspanNum === 1) {
            if (j === 0 || j === 1) classes.push("col-wei");
            if (j === 2 || j === 3) classes.push("col-shu");
            if (j === 4 || j === 5) classes.push("col-wu");

            if (j === 0 || j === 2 || j === 4) classes.push("start");
            if (j === 1 || j === 3 || j === 5) classes.push("end");
          }

          html += `<td class="${classes.join(" ")}" style="${color}" ${rowspan} ${colspanAttr}>${value}</td>`;
        }

        html += "</tr>";
      }

      html += "</table></div>";
      container.innerHTML = html;
    }

  </script>
  <div id="footer"></div>

<script>
  async function includeHTML(id, file, callback) {
    const res = await fetch(file);
    const html = await res.text();
    document.getElementById(id).innerHTML = html;

    if (callback) callback();
  }

  
  includeHTML("navbar", "../nav.html", () => {

    const script = document.createElement("script");
    script.src = "../scripts/navbar.js"; 
    script.defer = true;


    script.onload = () => {
      const isGithub = location.hostname.includes("github.io");
      const pathParts = window.location.pathname.split("/");
      const repoName = pathParts[1] || "";
      const basePath = isGithub ? `/${repoName}/` : "/";

      if (typeof setNavLinks === "function") {
        setNavLinks(basePath);
      } else {
        console.warn("Navbar logic (setNavLinks) did not load");
      }
    };

    document.head.appendChild(script);
  });

 
  includeHTML("footer", "../footer.html");
</script>
</body>
</html>